# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ lamp ]
  
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      # Runs a set of commands using the runners shell
      - name: Run a multi-line script
        run: sudo apt install awscli -y && aws configure set aws_access_key_id ${{ secrets.ACCESS_KEY_ID }} && aws configure set aws_secret_access_key ${{ secrets.SECRET_ACCESS_KEY }} && wget https://releases.hashicorp.com/terraform/1.0.11/terraform_1.0.11_linux_amd64.zip && unzip *.zip && sudo mv terraform /usr/local/bin && terraform init && touch file.txt && terraform apply -auto-approve > file.txt && touch ip.txt && grep -o '[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}' file.txt > ip.txt && cat ip.txt && ip=`cat ip.txt` && touch PEM.pem && echo "-----BEGIN RSA PRIVATE KEY-----MIIEowIBAAKCAQEAolVf2V5y0G10YqvNPJf9WIJyWxYVtljUxKYybwTbPmeydSitQrk8ar4FCqTNgElxbVmfKB5Y/JUPL9acO2yTJSs/IOuh05Wzj8UqBPQ7vOD4ug9ny2Qdu3sOpmwBNp411hMmUykXJPOJcUCx8bvsz4yBBjxjSn12GO2ujSPhBwwERpXtcO1x9EEMGTAeSHYfcKowAH+mu1Z31a4Ow4RVCy58CBJsLPnBBPU/q9315Ycl4xMkFkwHONiYzSz6RG/0hv1cZflPzmTFWFWXAMEOUmgkjVhkR/tc5rEq7U/pxHnwZiKrrWZnrxKCbRpc5T43hWOy7Wzuszgn569Nina4aQIDAQABAoIBAByappUKy3hmkQeB9lwi/AVIlxXtwk2rQXKVRnXBiVBpvUxfqogDU94LNaA2ge+FAXOfQygykMOREGgBjO37p8H46NrIKm+6BTXkLA9LaetSSQGgDU4Nih+rA13X0i7pmdrq7OniZ62fLCzElZZe4s9/loyev3A0w0aJOySrmc8/yd1fBhVsq6Fc6XL5JYPxpKsMtsU7K3qVhzMgyi84huioyRutAkjEoc6gylA87xN6MKfi0P+cA+K8jFeBHMBKwIeNvBqUFMNSDhHlotEM6esjY8jVlJFOt0ZaMkEur5GfAPmoEuWXMkulzeQaN8uYMzb0DoK+plqfJ1HyO9gEIAECgYEA8vjC8FM7tI40iXa7e7NnKYy21/Q4cJhijTyoULBpH4Lx3JXa1iFaNwGZd6e8gnaGTqO9F2QHlex+DVD1PEaMfR6xowWEFtk1btTqsK3CIwbLAanEZwteF1eAwdxHEz2lfkUrtGIjNqH3gmTnE4bejkFkkP1w2TJ8pESEIQb2KwECgYEAqwm0DcbSb9pgVTyDKqv0bwC9H8kytlHAAMBkxW8thGzX8Hu/NoE6ZPbMSXTZ6B5fAkvwf72YVrlS2chbHf5ufPFVqcNpzFidLGUCVoZuq6Bx+eq6+XLPRUUGiwrOeWmwHvBCgODO2swxwUw13EKed+SwW7C8IEr2hxI97tX4FWkCgYEAmT+99McKyX9IM8vnxMYLM3HFgcBQOPRkdKDlqL8cDvwQgQkj1huDQ16G5amuhLstSzyLb81v22gmuU9u3m3A/sn1UNWR0rd9tEInJPjzkhQexxXFAxlwZ1iRpbTCP6iKUXJfdo7Plw3hhyUNeot+pEsqmyi/nL7zTsjIbexuKAECgYB1XMEqOuWnTuePVWiD3V5q1MzxhLPBmzLu0RXUzEcleTJrl95LXj1djmP7e60Ss9Rp1QYAAW8JAz2wpuSvHilenpMzXB261It1LRJ/oNtL9VqALOuDw54qYATvX8jyUu1BLYfUu231gOwbQVor+6KVjlzdbdaJKicj5AaPXk9PEQKBgHE+5PDFcx/Fx5yIwhHkq3mUzbQhi/iErqa+F/qd9PxCq1bCJ+ja5kZMJSFbQrxPAymfFnLkqAog06LbTX8BdZkLGnf/i4r4MIpO1PSET0MA2CAQL6g8DV9Kh879o76Fl8+YRKp55UmXNWqzAFMbgyw/5FsILoM7UXvwQteQ0BAU-----END RSA PRIVATE KEY-----" >> PEM.pem && chmod 400 PEM.pem && ssh -i "PEM.pem" ubuntu@$ip -oStrictHostKeyChecking=no
#       - name: SSH 
#         uses: actions/checkout@v2

#         with:
#           host: $ip
#           username: "ubuntu"
#           ssh-key: ${{ secrets.PRIVATE_KEY }}
#           script: sudo apt-get update -y
